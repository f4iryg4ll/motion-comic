<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Topik 2 - Zaman Kegemilangan Melaka</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #CD853F 100%);
      color: white;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .quiz-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
    }

    .back-btn {
      background: #DEB887;
      color: #654321;
      padding: 12px 20px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      display: inline-block;
      white-space: nowrap;
    }

    .back-btn:hover {
      background: #F5DEB3;
      transform: scale(1.05);
    }

    .header .back-btn {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
    }

    .header .back-btn:hover {
      transform: translateY(-50%) scale(1.05);
    }

    .quiz-title {
      font-size: 2.5em;
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      margin-bottom: 10px;
      color: #F5DEB3;
    }

    .quiz-subtitle {
      opacity: 0.9;
      font-size: 1.2em;
      color: #DEB887;
    }

    .game-stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(139, 69, 19, 0.3);
      padding: 20px;
      border-radius: 20px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(222, 184, 135, 0.3);
    }

    .score-display {
      text-align: center;
    }

    .score-label {
      font-size: 0.9em;
      opacity: 0.8;
      color: #DEB887;
    }

    .score-value {
      font-size: 2em;
      font-weight: bold;
      color: #F5DEB3;
      position: relative;
    }

    .powers-container {
      display: flex;
      gap: 15px;
    }

    .power-item {
      position: relative;
      background: rgba(222, 184, 135, 0.15);
      border: 2px solid #DEB887;
      border-radius: 15px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      min-width: 80px;
    }

    .power-item:hover {
      transform: scale(1.05);
      background: rgba(222, 184, 135, 0.25);
      box-shadow: 0 0 20px rgba(222, 184, 135, 0.5);
    }

    .power-item.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      border-color: #8B7355;
    }

    .power-icon {
      font-size: 1.8em;
      margin-bottom: 5px;
    }

    .power-name {
      font-size: 0.8em;
      font-weight: bold;
      color: #F5DEB3;
    }

    .power-uses {
      font-size: 0.7em;
      opacity: 0.8;
      color: #DEB887;
    }

    .question-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .question-counter {
      background: rgba(139, 69, 19, 0.4);
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: bold;
      color: #F5DEB3;
      border: 1px solid rgba(222, 184, 135, 0.3);
    }

    .timer-container {
      position: relative;
      width: 80px;
      height: 80px;
    }

    .timer-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: conic-gradient(#DEB887 0deg, transparent 0deg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      font-weight: bold;
      transition: all 0.1s ease;
      color: #654321;
    }

    .question-card {
      background: rgba(139, 69, 19, 0.2);
      border-radius: 25px;
      padding: 40px;
      margin-bottom: 30px;
      backdrop-filter: blur(15px);
      border: 1px solid rgba(222, 184, 135, 0.3);
    }

    .question-text {
      font-size: 1.5em;
      font-weight: 600;
      text-align: center;
      line-height: 1.4;
      margin-bottom: 30px;
      color: #F5DEB3;
    }

    .answers-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .answer-option {
      background: rgba(222, 184, 135, 0.1);
      border: 3px solid transparent;
      border-radius: 20px;
      padding: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      font-size: 1.1em;
      font-weight: 500;
      position: relative;
      overflow: hidden;
      color: #F5DEB3;
    }

    .answer-option:hover {
      transform: scale(1.02);
      background: rgba(222, 184, 135, 0.2);
      border-color: #DEB887;
    }

    .answer-option.selected {
      border-color: #DEB887;
      background: rgba(222, 184, 135, 0.3);
    }

    .answer-option.correct {
      border-color: #90EE90;
      background: rgba(144, 238, 144, 0.3);
      animation: correctPulse 0.6s ease;
    }

    .answer-option.wrong {
      border-color: #FFB6C1;
      background: rgba(255, 182, 193, 0.3);
      animation: wrongShake 0.6s ease;
    }

    .answer-letter {
      position: absolute;
      top: 10px;
      left: 15px;
      background: #DEB887;
      color: #654321;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9em;
    }

    .hang-tuah-quiz {
      position: fixed;
      bottom: 30px;
      right: 200px;
      width: 150px;
      height: 150px;
      z-index: 1000;
      cursor: pointer;
    }

    .character-sprite-quiz {
      width: 100%;
      height: 100%;
      background-image: url('images/hangtuah.png');
      background-size: contain;
      background-repeat: no-repeat;
      animation: quizIdle 4s ease-in-out infinite;
      filter: drop-shadow(2px 2px 8px rgba(0,0,0,0.3));
    }

    .speech-bubble-quiz {
      position: absolute;
      bottom: 150px;
      left: -100px;
      background: linear-gradient(135deg, #F5DEB3 0%, #DEB887 100%);
      color: #654321;
      padding: 15px 20px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 6px 25px rgba(0,0,0,0.3);
      opacity: 0;
      transform: scale(0);
      transition: all 0.4s ease;
      max-width: 250px;
      text-align: center;
      border: 3px solid #CD853F;
      z-index: 1001;
      white-space: normal;
      word-wrap: break-word;
    }

    .speech-bubble-quiz.show {
      opacity: 1;
      transform: scale(1);
    }

    .speech-bubble-quiz::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 120px;
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-top: 15px solid #F5DEB3;
    }

    .results-screen {
      display: none;
      text-align: center;
      background: rgba(139, 69, 19, 0.2);
      border-radius: 30px;
      padding: 50px;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(222, 184, 135, 0.3);
      margin-bottom: 50px;
    }

    .results-title {
      font-size: 3em;
      font-weight: bold;
      margin-bottom: 20px;
      color: #F5DEB3;
    }

    .final-score {
      font-size: 4em;
      font-weight: bold;
      color: #90EE90;
      margin: 20px 0;
    }

    .results-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      margin: 40px 0;
    }

    .stat-item {
      background: rgba(222, 184, 135, 0.1);
      padding: 20px;
      border-radius: 15px;
      border: 1px solid rgba(222, 184, 135, 0.3);
    }

    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #F5DEB3;
    }

    .stat-label {
      opacity: 0.8;
      margin-top: 5px;
      color: #DEB887;
    }

    .results-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      align-items: center;
      margin-top: 30px;
      flex-wrap: wrap;
      padding: 20px 0;
    }

    .btn-restart {
      background: #4CAF50;
      color: white;
    }

    .btn-home {
      background: #2196F3;
      color: white;
    }

    .btn-restart:hover { background: #45a049; }
    .btn-home:hover { background: #1976D2; }

    @keyframes correctPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(144, 238, 144, 0.8); }
      100% { transform: scale(1); }
    }

    @keyframes wrongShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    @keyframes quizIdle {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(3deg); }
    }

    @keyframes powerActivate {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); box-shadow: 0 0 25px #DEB887; }
      100% { transform: scale(1); }
    }

    .power-activated {
      animation: powerActivate 0.8s ease;
    }

    @keyframes scoreFloat {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-50px); opacity: 0; }
    }
    
    @keyframes pulse {
      from { transform: scale(1); }
      to { transform: scale(1.1); }
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .quiz-title {
        font-size: 2em;
      }
      
      .answers-grid {
        grid-template-columns: 1fr;
      }
      
      .game-stats {
        flex-direction: column;
        gap: 20px;
      }
      
      .powers-container {
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .hang-tuah-quiz {
        width: 100px;
        height: 100px;
        bottom: 20px;
        right: 20px;
      }
      
      .speech-bubble-quiz {
        bottom: 105px;
        left: -80px;
        font-size: 11px;
        max-width: 160px;
        padding: 8px 12px;
      }

      .speech-bubble-quiz::after {
        left: 90px;
      }

      .results-buttons {
        display: flex;
        flex-direction: row;
        justify-content: space-around;
        gap: 15px;
        margin-top: 30px;
        padding: 0 10px;
        flex-wrap: wrap;
      }
      
      .results-buttons .back-btn {
        flex: 1;
        min-width: 120px;
        max-width: 160px;
        margin: 5px;
        padding: 12px 8px;
        font-size: 0.85em;
        text-align: center;
      }
      
      .results-screen {
        padding: 30px 15px 50px 15px;
        margin-bottom: 30px;
      }

      .results-stats {
        grid-template-columns: 1fr;
        gap: 15px;
        margin: 30px 0;
      }
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <div class="header">
      <a href="topik2.html" class="back-btn">← Kembali</a>
      <h1 class="quiz-title">👑 KUIZ TOPIK 2 👑</h1>
      <p class="quiz-subtitle">Zaman Kegemilangan Melaka</p>
    </div>

    <div class="game-stats">
      <div class="score-display">
        <div class="score-label">Skor Anda</div>
        <div class="score-value" id="currentScore">0</div>
      </div>
      
      <div class="powers-container">
        <div class="power-item" id="kerisKeemasan" onclick="usePower('keris')">
          <div class="power-icon">🗡️</div>
          <div class="power-name">Keris Emas</div>
          <div class="power-uses">2x Skor (1x)</div>
        </div>
        
        <div class="power-item" id="perisaiBesi" onclick="usePower('perisai')">
          <div class="power-icon">🛡️</div>
          <div class="power-name">Perisai Besi</div>
          <div class="power-uses">Skip Soalan (1x)</div>
        </div>
        
        <div class="power-item" id="mataPedang" onclick="usePower('mata')">
          <div class="power-icon">👁️</div>
          <div class="power-name">Mata Pedang</div>
          <div class="power-uses">Buang 2 Pilihan (2x)</div>
        </div>
      </div>
    </div>

    <div class="question-section" id="questionSection">
      <div class="question-header">
        <div class="question-counter" id="questionCounter">Soalan 1 / 12</div>
        <div class="timer-container">
          <div class="timer-circle" id="timerCircle">15</div>
        </div>
      </div>

      <div class="question-card">
        <div class="question-text" id="questionText">
          Siapakah Sultan yang memerintah semasa zaman kegemilangan Melaka?
        </div>
        
        <div class="answers-grid" id="answersGrid">
          <div class="answer-option" onclick="selectAnswer(0)">
            <div class="answer-letter">A</div>
            <div>Sultan Muzaffar Shah</div>
          </div>
          <div class="answer-option" onclick="selectAnswer(1)">
            <div class="answer-letter">B</div>
            <div>Parameswara</div>
          </div>
          <div class="answer-option" onclick="selectAnswer(2)">
            <div class="answer-letter">C</div>
            <div>Sultan Mahmud Shah</div>
          </div>
          <div class="answer-option" onclick="selectAnswer(3)">
            <div class="answer-letter">D</div>
            <div>Sultan Alauddin Shah</div>
          </div>
        </div>
      </div>
    </div>

    <div class="results-screen" id="resultsScreen">
      <div class="results-title">🎉 TAMAT! 🎉</div>
      <div class="final-score" id="finalScore">850</div>
      
      <div class="results-stats">
        <div class="stat-item">
          <div class="stat-value" id="correctAnswers">8</div>
          <div class="stat-label">Jawapan Betul</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="accuracyPercent">80%</div>
          <div class="stat-label">Ketepatan</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="powerUsed">2</div>
          <div class="stat-label">Kuasa Digunakan</div>
        </div>
      </div>
      
      <div class="results-buttons">
        <button onclick="restartQuiz()" class="back-btn btn-restart">🔄 Main Semula</button>
        <a href="index.html" class="back-btn btn-home">🏠 Halaman Utama</a>
      </div>
    </div>
  </div>

  <div class="hang-tuah-quiz" id="hangTuahQuiz" onclick="hangTuahSpeak()">
    <div class="character-sprite-quiz"></div>
    <div class="speech-bubble-quiz" id="speechBubbleQuiz">Era kegemilangan menanti!</div>
  </div>

  <script>
    const quizData = [
      {
        question: "Siapakah Sultan yang memerintah semasa zaman kegemilangan Melaka?",
        options: ["Sultan Muzaffar Shah", "Parameswara", "Sultan Mahmud Shah", "Sultan Alauddin Shah"],
        correct: 0,
        hint: "Beliau adalah Sultan ketiga Melaka dan dikenali sebagai pemimpin yang bijaksana!"
      },
      {
        question: "Apakah sistem pentadbiran yang digunakan di Melaka?",
        options: ["Sistem Dua Lipatan", "Sistem Empat Lipatan", "Sistem Enam Lipatan", "Sistem Lapan Lipatan"],
        correct: 1,
        hint: "Sistem ini membahagikan pentadbiran kepada empat bahagian utama!"
      },
      {
        question: "Siapakah yang berada di puncak Sistem Pembesar Empat Lipatan?",
        options: ["Bendahara", "Temenggung", "Sultan", "Laksamana"],
        correct: 2,
        hint: "Beliau adalah pahlawan yang paling terkenal dan setia kepada Sultan!"
      },
      {
        question: "Apakah nama undang-undang yang terkenal di Melaka?",
        options: ["Undang-undang Laut Melaka", "Hukum Kanun Melaka", "Undang-undang Kedah", "Hukum Johor"],
        correct: 1,
        hint: "Undang-undang ini menjadi asas perundangan di Nusantara!"
      },
      {
        question: "Antara berikut, yang manakah BUKAN kawasan yang ditadbir oleh pembesar ?",
        options: ["Pemakanan", "Ufti", "Perikanan", "Pegangan"],
        correct: 2,
        hint: "Pelabuhan ini terletak di Sumatera dan merupakan bekas pusat Srivijaya!"
      },
      {
        question: "Apakah agama rasmi Kesultanan Melaka?",
        options: ["Hindu", "Buddha", "Islam", "Kristian"],
        correct: 2,
        hint: "Agama ini dibawa masuk oleh pedagang dari Arab dan India!"
      },
      {
        question: "Cara pembentukan empayar Melaka termasuk yang berikut KECUALI:",
        options: ["Pembelian tanah", "Penaklukan", "Naungan", "Perkahwinan"],
        correct: 0,
        hint: "Mereka datang untuk berdagang dan sekaligus menyebarkan agama!"
      },
      {
        question: "Hukum Kanun Melaka mengandungi berapa fasal?",
        options: ["44 fasal", "50 fasal", "25 fasal", "32 fasal"],
        correct: 0,
        hint: "Mata wang kecil yang diperbuat daripada timah!"
      },
      {
        question: "Undang-Undang Laut Melaka mengandungi berapa fasal?",
        options: ["15 fasal", "50 fasal", "44 fasal", "25 fasal"],
        correct: 3,
        hint: "Logam ini banyak terdapat di Semenanjung Tanah Melayu!"
      },
      {
        question: "Perkahwinan Sultan Mansur Shah dengan puteri Majapahit bertujuan untuk:",
        options: ["Mendapatkan bantuan ketenteraan", "Mengukuhkan hubungan dan meluaskan pengaruh", "Memperoleh teknologi baru", "Menguasai perdagangan rempah"],
        correct: 1,
        hint: "Kepulauan ini terkenal dengan pala dan cengkeh!"
      },
      {
        question: "Pengislaman pemerintah Melaka terjadi pada tahun:",
        options: ["1400", "1414", "1446", "1511"],
        correct: 1,
        hint: "Gelaran ini menunjukkan Melaka sebagai pusat perdagangan Timur!"
      },
      {
        question: "Berapa luas empayar Melaka pada zaman kegemilangannya?",
        options: ["Meliputi Semenanjung sahaja", "Meliputi Sumatera dan Semenanjung", "Meliputi seluruh Nusantara", "Meliputi Asia Tenggara"],
        correct: 1,
        hint: "Empayar ini meliputi kedua-dua belah Selat Melaka!"
      }
    ];

    let currentQuestion = 0;
    let score = 0;
    let timeLeft = 15;
    let timerInterval;
    let selectedAnswer = -1;
    let correctAnswers = 0;
    let powersUsed = 0;
    let kerisActive = false;

    let powers = {
      keris: 1,
      perisai: 1,
      mata: 2
    };

    const hangTuahPhrases = {
      welcome: ["Era kegemilangan menanti!", "Mari uji pengetahuan zaman gemilang!", "Kuasa Sultan menanti!"],
      correct: ["Betul!", "Syabas! Anda berjaya!", "Hebat! Empayar gemilang!", "Laksamana bangga!"],
      wrong: ["Tidak mengapa, era ini kompleks!", "Jangan berputus asa!", "Belajar dari sejarah!", "Semangat juang pantang mundur!"],
      hint: ["Petunjuk dari zaman kegemilangan!", "Hint dari Hang Tuah!", "Sejarah memberitahu!"],
      power: ["Kuasa kegemilangan diaktifkan!", "Taming Sari bersinar terang!", "Keajaiban empayar!", "Hebat tuanku!"],
      final: ["Tamat! Era kegemilangan dikuasai!", "Syabas! Pengetahuan yang luas!", "Hang Tuah berbangga dengan pencapaian!"]
    };

    function hangTuahSpeak(customPhrase = null, category = 'welcome') {
      const bubble = document.getElementById('speechBubbleQuiz');
      let phrase;
      
      if (customPhrase) {
        phrase = customPhrase;
      } else {
        const phrases = hangTuahPhrases[category];
        phrase = phrases[Math.floor(Math.random() * phrases.length)];
      }
      
      bubble.textContent = phrase;
      bubble.classList.add('show');
      
      setTimeout(() => {
        bubble.classList.remove('show');
      }, 3000);
    }

    function usePower(powerType) {
      if (powers[powerType] <= 0) return;
      
      const powerElement = document.getElementById(
        powerType === 'keris' ? 'kerisKeemasan' : 
        powerType === 'perisai' ? 'perisaiBesi' : 'mataPedang'
      );
      
      powerElement.classList.add('power-activated');
      setTimeout(() => powerElement.classList.remove('power-activated'), 800);
      
      powers[powerType]--;
      powersUsed++;
      
      switch(powerType) {
        case 'keris':
          kerisActive = true;
          hangTuahSpeak("Keris Emas diaktifkan! Skor berganda untuk soalan ini!", 'power');
          break;
          
        case 'perisai':
          hangTuahSpeak("Perisai Besi melindungi! Soalan ini dilangkau!", 'power');
          setTimeout(() => {
            correctAnswers++;
            score += kerisActive ? 200 : 100;
            kerisActive = false;
            nextQuestion();
          }, 2000);
          break;
          
        case 'mata':
          removeWrongAnswers();
          hangTuahSpeak("Mata Pedang melihat! Dua pilihan salah telah dibuang!", 'power');
          break;
      }
      
      updatePowerDisplay();
    }

    function removeWrongAnswers() {
      const answers = document.querySelectorAll('.answer-option');
      const correctIndex = quizData[currentQuestion].correct;
      let removedCount = 0;
      
      answers.forEach((answer, index) => {
        if (index !== correctIndex && removedCount < 2) {
          answer.style.opacity = '0.3';
          answer.style.pointerEvents = 'none';
          removedCount++;
        }
      });
    }

    function updatePowerDisplay() {
      document.getElementById('kerisKeemasan').querySelector('.power-uses').textContent = `2x Skor (${powers.keris}x)`;
      document.getElementById('perisaiBesi').querySelector('.power-uses').textContent = `Skip Soalan (${powers.perisai}x)`;
      document.getElementById('mataPedang').querySelector('.power-uses').textContent = `Buang 2 Pilihan (${powers.mata}x)`;
      
      Object.keys(powers).forEach(power => {
        const element = document.getElementById(
          power === 'keris' ? 'kerisKeemasan' : 
          power === 'perisai' ? 'perisaiBesi' : 'mataPedang'
        );
        
        if (powers[power] <= 0) {
          element.classList.add('disabled');
        }
      });
    }

    function startTimer() {
      timeLeft = 15;
      updateTimerDisplay();
      
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          if (selectedAnswer === -1) {
            hangTuahSpeak("Masa tamat! Era ini memerlukan masa untuk dipahami!", 'wrong');
            setTimeout(nextQuestion, 2000);
          }
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const circle = document.getElementById('timerCircle');
      circle.textContent = timeLeft;
      
      const percentage = (timeLeft / 15) * 360;
      circle.style.background = `conic-gradient(#DEB887 ${percentage}deg, transparent ${percentage}deg)`;
      
      if (timeLeft <= 5) {
        circle.style.background = `conic-gradient(#FFB6C1 ${percentage}deg, transparent ${percentage}deg)`;
        circle.style.animation = 'pulse 0.5s infinite alternate';
      } else {
        circle.style.animation = 'none';
      }
    }

    function loadQuestion() {
      const question = quizData[currentQuestion];
      
      document.getElementById('questionText').textContent = question.question;
      document.getElementById('questionCounter').textContent = `Soalan ${currentQuestion + 1} / ${quizData.length}`;
      
      const answersGrid = document.getElementById('answersGrid');
      answersGrid.innerHTML = '';
      
      question.options.forEach((option, index) => {
        const answerDiv = document.createElement('div');
        answerDiv.className = 'answer-option';
        answerDiv.onclick = () => selectAnswer(index);
        answerDiv.innerHTML = `
          <div class="answer-letter">${String.fromCharCode(65 + index)}</div>
          <div>${option}</div>
        `;
        answersGrid.appendChild(answerDiv);
      });
      
      selectedAnswer = -1;
      kerisActive = false;
      startTimer();
    }

    function selectAnswer(answerIndex) {
      if (selectedAnswer !== -1) return;
      
      clearInterval(timerInterval);
      selectedAnswer = answerIndex;
      
      const answers = document.querySelectorAll('.answer-option');
      const correctIndex = quizData[currentQuestion].correct;
      
      answers[answerIndex].classList.add('selected');
      
      setTimeout(() => {
        answers[correctIndex].classList.add('correct');
        
        if (answerIndex === correctIndex) {
          const points = kerisActive ? 200 : 100;
          score += points;
          correctAnswers++;
          
          hangTuahSpeak(null, 'correct');
          showScoreAnimation(points);
          
        } else {
          answers[answerIndex].classList.add('wrong');
          hangTuahSpeak(null, 'wrong');
        }
        
        kerisActive = false;
        updateScore();
        
        setTimeout(nextQuestion, 2500);
      }, 500);
    }

    function showScoreAnimation(points) {
      const scoreElement = document.getElementById('currentScore');
      const animationDiv = document.createElement('div');
      animationDiv.textContent = `+${points}`;
      animationDiv.style.cssText = `
        position: absolute;
        top: -30px;
        right: 0;
        color: #90EE90;
        font-weight: bold;
        font-size: 1.5em;
        animation: scoreFloat 2s ease-out forwards;
        pointer-events: none;
        z-index: 100;
      `;
      
      scoreElement.parentElement.style.position = 'relative';
      scoreElement.parentElement.appendChild(animationDiv);
      
      setTimeout(() => animationDiv.remove(), 2000);
    }

    function nextQuestion() {
      currentQuestion++;
      
      if (currentQuestion >= quizData.length) {
        showResults();
      } else {
        loadQuestion();
      }
    }

    function updateScore() {
      document.getElementById('currentScore').textContent = score;
    }

    function showResults() {
      document.getElementById('questionSection').style.display = 'none';
      document.getElementById('resultsScreen').style.display = 'block';
      
      const accuracy = Math.round((correctAnswers / quizData.length) * 100);
      
      document.getElementById('finalScore').textContent = score;
      document.getElementById('correctAnswers').textContent = correctAnswers;
      document.getElementById('accuracyPercent').textContent = accuracy + '%';
      document.getElementById('powerUsed').textContent = powersUsed;

      // Show congratulatory messages based on performance
      if (accuracy >= 70) {
        hangTuahSpeak("Tahniah! Anda telah menguasai era kegemilangan Melaka dengan cemerlang!", 'final');
      } else if (accuracy >= 50) {
        hangTuahSpeak("Tidak mengapa! Cuba lagi untuk menguasai era kegemilangan!", 'final');
      } else {
        hangTuahSpeak("Jangan berputus asa! Pelajari semula zaman kegemilangan ini!", 'final');
      }
    }

    function restartQuiz() {
      currentQuestion = 0;
      score = 0;
      correctAnswers = 0;
      powersUsed = 0;
      selectedAnswer = -1;
      kerisActive = false;
      
      powers = { keris: 1, perisai: 1, mata: 2 };
      
      document.getElementById('questionSection').style.display = 'flex';
      document.getElementById('resultsScreen').style.display = 'none';
      
      // Reset power displays
      document.querySelectorAll('.power-item').forEach(item => {
        item.classList.remove('disabled');
      });
      
      updateScore();
      updatePowerDisplay();
      loadQuestion();
      
      hangTuahSpeak("Sedia untuk cabaran era kegemilangan baru!", 'welcome');
    }

    function showHint() {
      const hint = quizData[currentQuestion].hint;
      hangTuahSpeak(hint, 'hint');
    }

    // Initialize quiz
    document.addEventListener('DOMContentLoaded', function() {
      updateScore();
      updatePowerDisplay();
      loadQuestion();
      
      setTimeout(() => {
        hangTuahSpeak("Selamat datang ke era kegemilangan Melaka!", 'welcome');
      }, 1000);
    });

    document.getElementById('questionText').addEventListener('dblclick', showHint);
  </script>
</body>
</html>